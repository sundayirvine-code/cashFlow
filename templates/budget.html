<!--templates/budget.html-->
{% extends "base.html" %}

{% block links %}
    <link rel="stylesheet" href="/static/styles/budget.css">
{% endblock %}

{% block title %}CashFlow | Budget{% endblock %}

{% block content %}
<h3 style="margin: 0;" class="mt-3">Budget Management</h3>

<div id="budgetChartSummary">
    <div id="budgetChart">

    </div>
    <div id="budgetSummary">

    </div>
</div>

<div id="searchBudgets">
    <div id="year">
        <label for="yearSelect">Select Year:</label>
        <select class="form-control" id="yearSelect">
        </select>
    </div>
    <div id="month">
        <label for="monthSelect">Select Month:</label>
        <select class="form-control" id="monthSelect">
        </select>
    </div>
    <div id="button">
        <button class="btn btn-primary" id="searchButton">Search</button>
    </div>
</div>

<div id="title">
    <p>Prev Budgets</p>
    {% if not current_budget %}
    <i class="bi bi-plus-lg" id="createBudget" ></i>
    {% endif %}
</div>


<div id="previousBudgets">
    <!-- Budget Expense transactions will be inserted here -->
    {% for budget in budgets %}
    <div class="budgetcard" data-budget-id="{{ budget.id }}">
        <h4>{{ (budget.month) }} {{ budget.year }}</h4>
        {% if budget.expected_amount %}
        <p>Estimate: {{budget.expected_amount}}</p>
        {% else %}
        <p>Estimate: 0.00</p>
        {% endif %}
        {% if budget.spent_amount %}
        <p>Actual: {{budget.spent_amount}}</p>
        {% else %}
        <p>Actual: 0.00</p>
        {% endif %}
    </div>
    {% endfor %}
</div>


<main id="currentBudget">
    <div id="banner">
        {% if current_budget %}
        <div id="bugetname">
            <h4 id="currentBudgetInfo">{{current_budget.month}} {{current_budget.year}}</h4>
            <div>
                <i class="bi bi-dash-lg"></i>
                <p>Budget Plan</p>
                <i class="bi bi-dash-lg"></i>
            </div>
        </div>
        {% endif %}
        <div>
            <i class="bi bi-plus-lg" id="addBudgetExpenses" style="display:{% if current_budget %}inline{% else %}none{% endif %} ;"></i>
        </div>
    </div>
    <div id="budgetTable">
        <table class="table table-responsive-sm" id="table">
            <thead>
                <tr>
                    <th scope="col">Expense</th>
                    <th scope="col">Estimate</th>
                    <th scope="col">Actual</th>
                    <th scope="col">Progress</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="transactionTableBody">
                <!-- Loop through budget expenses and populate rows -->
                {% for expense in budget_expenses %}
                <tr data-row-id="{{ expense.id }}">
                    <td>{{ expense.expense_name }}</td>
                    <td>{{ expense.expected_amount }}</td>
                    <td>{{ expense.spent_amount }}</td>
                    <td>{{ (expense.spent_amount / expense.expected_amount * 100)|round(2) }}%</td>
                    <td class="actions">
                        <!-- Edit and Delete buttons with appropriate data attributes -->
                        <i class="fas fa-edit edit-transaction"
                           data-budgetexpense-id="{{ expense.id }}"
                           data-budget-id="{{ expense.budget_id }}"
                           data-estimate="{{ expense.expected_amount }}"
                           data-expensename="{{ expense.expense_name }}"
                           data-expenseid="{{ expense.expense_id }}"
                           aria-hidden="true"></i>
                        <i class="fas fa-trash-alt delete-transaction"
                           data-budgetexpense-id="{{ expense.id }}"
                           aria-hidden="true"></i>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</main>


<!-- Form to create a budgetExpense transaction -->
<div id="modal-create" style="display: none;">
    <div class="row g-3">              
    
        <div class="col-md-6 ">      
            <label for="Expense">Choose Expense</label>          
            <select class="form-select" id="Expense" name="Expense">
                <option value=""></option>
            </select>          
        </div>

        <div class="col-md-6">
            <label for="Expectedamount">Expected Amount</label>           
            <input class="form-control" id="Expectedamount" name="Expectedamount" placeholder="Expected Amount" required type="number" min="0">           
        </div>

        <div style="display: flex; justify-content: space-evenly;">
            <button id="cancel" class="btn btn-danger col-md-3">Cancel</button>
            <button  id="submit" class="btn btn-primary col-md-3">Submit</button>
        </div>
    </div>
</div>

<!-- Form to edit a budgetExpense transaction -->
<div id="modal-edit" style="display: none;">
    <div class="row g-3">              
    
        <div class="col-md-6 ">      
            <label for="editExpense">Choose Expense</label>          
            <select class="form-select" id="editExpense" name="Expense">
                <option value=""></option>
            </select>          
        </div>

        <div class="col-md-6">
            <label for="Expectedamount">Expected Amount</label>           
            <input class="form-control" id="editExpectedamount" name="editExpectedamount" placeholder="Expected Amount" required type="number" min="0">           
        </div>

        <div style="display: flex; justify-content: space-evenly;">
            <button id="editcancel" class="btn btn-danger col-md-3">Cancel</button>
            <button id="editsubmit" class="btn btn-primary col-md-3">Submit</button>
        </div>
    </div>
</div>

<!-- Delete confirmation modal -->
<div id="modal-delete" style="display: none;">
    <p>Are you sure you want to delete this transaction?</p>
    <button id="modal-content-delete" class="btn btn-danger col-md-3">Delete</button>
    <button id="modal-content-cancel" class="btn btn-primary col-md-3">Cancel</button>
</div>

<div id="successMessage"></div>
<div id="errorMessage"></div>

<script src="/static/script/searchBudget.js"></script>
<script src="/static/script/budget.js"></script>
{% endblock %}